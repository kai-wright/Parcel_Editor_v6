class e{validate(){let e=[];return 0===this.result.length&&e.push(["warning","Interaction is missing a result."]),0===this.require.length&&0===this.consume.length&&e.push(["warning","Interaction is missing a requirement or consumption."]),e}validateProperty(e,t){let i=[];return"result"==e?0===this.result.length&&i.push(["warning","Interaction is missing a result."]):0===this.require.length&&0===this.consume.length&&i.push(["warning","Interaction is missing a requirement or consumption."]),i=[...i,...this.validateSubproperties(t)]}validateSubproperties(e){let t=[];for(let i of["result","require","consume"]){for(let n in this[i])e.includes(this[i][n][0])||t.push(["warning","Invalid "+i+" ID: "+this[i][n][0]]);for(let e in this[i])this[i][e][1]<=0?t.push(["invalid","Invalid "+i+" quantity: "+this[i][e][1]]):this[i][e][1]<0&&t.push(["warning","Invalid "+i+" quantity: "+this[i][e][1]])}return t}constructor(){this.unlocked=!1,this.result=[],this.require=[],this.consume=[]}}class t{constructor(){this.unlocked=!1,this.count=0,this.effect_add=0,this.effect_multiply=0,this.require=[],this.consume=[]}}const i=RegExp("^[a-z]([a-z_]*[a-z])?$"),n=RegExp("^[a-zA-Z](?:[a-zA-Z ]*[a-zA-Z])?$"),r=RegExp("^(resource|structure|research|unique):(([a-z]([a-z_]*[a-z])?))$");class a{constructor(e,t,i){this.id=e,this.type=t,this.name=i,this.unlocked=!1,this.interactions=[]}validate_parcel(){let e=[];for(let t in i.test(this.id)||e.push(["invalid","ID is invalid."]),n.test(this.name)||e.push(["warning","Name is invalid."]),e=[...e,...this.validate_self()],this.interactions)e=[...e,...this.validate_interaction[this.interactions[t]]];return e}validate_interaction(e){let t=[];for(let i in console.log(e),this[e])t=[...t,...this[e][i].validate()];return t}}class s extends a{constructor(e,t){super(e,"resource",t),this.id=e,this.name=t,this.type="resource",this.owned=0,this.interactions=["interaction_buy","interaction_sell","interaction_craft","interaction_generate"],this.interaction_buy=[],this.interaction_sell=[],this.interaction_craft=[],this.interaction_generate=[]}validate_self(){let e=[];e.push(d(this.owned,"Owned")),0===this.interaction_buy.length&&0===this.interaction_craft.length&&0===this.interaction_generate.length&&e.push(["warning","Interaction is missing a aquisition interaction."]);for(let t=0;t<this.interaction_buy.length;t++)e=[...e,...this.interaction_buy[t].validate()];for(let t=0;t<this.interaction_sell.length;t++)e=[...e,...this.interaction_sell[t].validate()];for(let t=0;t<this.interaction_craft.length;t++)e=[...e,...this.interaction_craft[t].validate()];for(let t=0;t<this.interaction_generate.length;t++)e=[...e,...this.interaction_generate[t].validate()];return e}}class l extends a{constructor(e,t){super(e,"structure",t),this.id=e,this.name=t,this.type="structure",this.owned=0,this.interactions=["interaction_buy","interaction_sell","interaction_craft","interaction_generate"],this.interaction_buy=[],this.interaction_sell=[],this.interaction_craft=[],this.interaction_generate=[]}validate_self(){let e=[];return e.push(d(this.owned,"Owned")),e}}class c extends a{constructor(e,t){super(e,"research",t),this.id=e,this.name=t,this.type="research",this.interactions=["interaction_craft"],this.interaction_craft=[]}validate_self(){return 0===this.interaction_craft.length?[["warning","Interaction is missing a craft interaction."]]:[]}}class o extends a{constructor(e,t){super(e,"unique",t),this.id=e,this.name=t,this.type="unique",this.owned=0}validate_self(){return[]}}function d(e,t){return e<0?["invalid",`${t} is negative or undefined.`]:["valid",`${t} is equal to or greater than zero.`]}function h(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()})}var p={id_to_name:function(e){return h(e.replaceAll("_"," "))},capitalise_all_words:h,capitalise_first_word:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},validity_check:function(e){let t="valid";for(let i in e){let n=e[i][0];if("valid"!=n){if("invalid"==n)t="invalid";else if("warning"==n)return"warning"}}return t},removeSymbols:function(e){return e.replaceAll("_"," ").replaceAll("-"," ").replaceAll(/[^a-zA-Z0-9\s]/g,"")}};const u=document.getElementById("parcel_list"),_=document.getElementById("parcel_edit"),m=document.getElementById("parcel_interaction_list"),g=document.getElementById("parcel_interaction_edit"),v=document.getElementById("parcel_interaction_set"),f=document.getElementById("parcel_add_type"),L=document.getElementById("parcel_add_id"),y=document.getElementById("parcel_add_button");function E(){""===L.value?L.classList.add("empty"):L.classList.remove("empty")}L.addEventListener("input",E),E();const w=new class{constructor(e=!0){this.version="Parcel Editor - 6.0.0",this.stored_parcel=[],e?(this.logVersion(),this.checkStorage(),this.clear(),console.log("Editor Ready!"),this.renderEditor()):console.warn("Editor started in uninitialised state.\n Did you want to do this?"),y.addEventListener("click",()=>{this.new_parcel(),this.refreshList()})}logVersion(){console.log(this.version)}save(){""===this.parcel.id?console.warn("Blank ID given to save process. Not saving"):i.test(this.parcel.id)?(localStorage.setItem(`${this.parcel.type}:${this.parcel.id}`,JSON.stringify(this.parcel)),console.log(`Saved ${this.parcel.type}:${this.parcel.id} to localStorage`)):console.error(`ID '${this.parcel.id}' is invalid. Failed to save data.`)}load(t){let i;if(i=localStorage.getItem(t)){let t=JSON.parse(i);switch(this.parcel=null,this.parcel=t,this.parcel.type){case"resource":this.parcel=new s(this.parcel.id,this.parcel.name),this.parcel.owned=t.owned||0,this.parcel.unlocked=t.unlocked||!1,this.parcel.interaction_buy=t.interaction_buy||[],this.parcel.interaction_sell=t.interaction_sell||[],this.parcel.interaction_craft=t.interaction_craft||[],this.parcel.interaction_generate=t.interaction_generate||[];break;case"structure":this.parcel=new l(this.parcel.id,this.parcel.name),this.parcel.owned=t.owned||0,this.parcel.unlocked=t.unlocked||!1,this.parcel.interaction_buy=t.interaction_buy||[],this.parcel.interaction_sell=t.interaction_sell||[],this.parcel.interaction_craft=t.interaction_craft||[],this.parcel.interaction_generate=t.interaction_generate||[],this.parcel.interaction_requirement=t.interaction_requirement||[];break;case"research":this.parcel=new c(this.parcel.id,this.parcel.name),this.parcel.unlocked=t.unlocked||!1,this.parcel.interaction_craft=t.interaction_craft||[];break;case"unique":this.parcel=new o(this.parcel.id,this.parcel.name),this.parcel.unlocked=t.unlocked||!1}let n=["interaction_buy","interaction_sell","interaction_craft","interaction_generate"];for(let t=0;t<n.length;t++){let i=n[t];if(this.parcel[i])for(let t=0;t<this.parcel[i].length;t++){let n=new e;n.result=this.parcel[i][t].result,n.consume=this.parcel[i][t].consume,n.require=this.parcel[i][t].require,n.unlocked=this.parcel[i][t].unlocked,this.parcel[i][t]=n}}console.info(`Loaded ${t.type}:${t.id}`)}else console.error(`${t} does not exist. Failed to load data.`)}new_parcel(){let e=f.value,t=L.value;if(!i.test(t)){console.error(`${t} is not a valid ID, unable to create`);return}this.save();let n=p.capitalise_all_words(p.removeSymbols(t));switch(e){case"resource":this.parcel=new s(t,n);break;case"structure":this.parcel=new l(t,n);break;case"research":this.parcel=new c(t,n);break;case"unique":this.parcel=new o(t,n)}this.save()}delete(e){localStorage.getItem(e)?(localStorage.removeItem(e),console.info(`Deleted ${e}`)):console.error(`${e} does not exist. Failed to delete data.`),e==`${this.parcel.type}:${this.parcel.id}`&&this.clear(),this.refreshList()}clear(e="resource",t=""){"resource"==e?this.parcel=new s(t,p.id_to_name(t)):"structure"==e?this.parcel=new l(t,p.id_to_name(t)):"research"==e?this.parcel=new c(t,p.id_to_name(t)):"unique"==e?this.parcel=new o(t,p.id_to_name(t)):console.error(`Invalid type '${e}' passed to clear()`)}checkStorage(){this.stored_parcel=[];for(let e=0;e<localStorage.length;e++){if(!r.test(localStorage.key(e)))continue;let t=localStorage.key(e);this.stored_parcel.push(t)}this.stored_parcel.sort((e,t)=>e.localeCompare(t)),console.table(this.stored_parcel)}refreshList(){this.checkStorage(),this.renderList()}clearDOM(){u.innerHTML="",_.innerHTML="",m.innerHTML="",g.innerHTML="",v.innerHTML=""}renderList(){if(this.clearDOM(),0===this.stored_parcel.length){console.warn("No parcels found");return}console.log("Rendering list of parcels");let e="";for(let t in this.stored_parcel){if(e!=this.stored_parcel[t].split(":")[0]){let i=document.createElement("h3");i.innerHTML=p.capitalise_first_word(this.stored_parcel[t].split(":")[0]),u.appendChild(i),e=this.stored_parcel[t].split(":")[0]}let i=document.createElement("button");i.innerHTML=this.stored_parcel[t],i.addEventListener("click",()=>{this.clearDOM(),this.load(this.stored_parcel[t]),this.renderEditor()}),u.appendChild(i)}}renderEditor(){if(this.clearDOM(),this.renderList(),void 0===this.parcel){console.warn("No parcel loaded. Failed to render editor.");return}let e=document.createElement("input");e.type="text",e.value=this.parcel.id,e.placeholder="ID",e.pattern="[a-z]([a-z_]*[a-z])?",e.addEventListener("change",()=>{i.test(e.value)&&(this.parcel.id=e.value)}),_.appendChild(e);let t=document.createElement("input");if(t.type="text",t.value=this.parcel.name,t.placeholder="Name",t.pattern="[a-zA-Z](?:[a-zA-Z ]*[a-zA-Z])?",t.addEventListener("change",()=>{n.test(t.value)&&(this.parcel.name=t.value)}),_.appendChild(t),"resource"==this.parcel.type||"structure"==this.parcel.type||"unique"==this.parcel.type){let e=document.createElement("input");e.type="number",e.value=this.parcel.owned.toString()||"0",e.placeholder="Owned",e.min="0",e.addEventListener("change",()=>{this.parcel.owned=Number(e.value)}),_.appendChild(e)}let r=document.createElement("div"),a=document.createElement("input"),s=document.createElement("label");if(s.innerHTML="Unlocked",a.type="checkbox",a.checked=this.parcel.unlocked,a.addEventListener("change",()=>{this.parcel.unlocked=!!a.checked}),r.appendChild(s),r.appendChild(a),_.appendChild(r),"resource"==this.parcel.type||"structure"==this.parcel.type){let e=document.createElement("button");e.innerHTML="Buy",this.parcel.interaction_buy&&this.parcel.interaction_buy.length>0&&(e.innerHTML+=` (${this.parcel.interaction_buy.length})`),e.addEventListener("click",()=>{this.renderInteractionList("interaction_buy")});let t=document.createElement("button");t.innerHTML="Sell",this.parcel.interaction_sell&&this.parcel.interaction_sell.length>0&&(t.innerHTML+=` (${this.parcel.interaction_sell.length})`),t.addEventListener("click",()=>{this.renderInteractionList("interaction_sell")}),_.appendChild(e),_.appendChild(t)}if("resource"==this.parcel.type||"structure"==this.parcel.type||"research"==this.parcel.type){let e=document.createElement("button");e.innerHTML="Craft",this.parcel.interaction_craft&&this.parcel.interaction_craft.length>0&&(e.innerHTML+=` (${this.parcel.interaction_craft.length})`),e.addEventListener("click",()=>{this.renderInteractionList("interaction_craft")}),_.appendChild(e)}if("resource"==this.parcel.type){let e=document.createElement("button");e.innerHTML="Generate",this.parcel.interaction_generate&&this.parcel.interaction_generate.length>0&&(e.innerHTML+=` (${this.parcel.interaction_generate.length})`),e.addEventListener("click",()=>{this.renderInteractionList("interaction_generate")}),_.appendChild(e)}if("structure"==this.parcel.type){let e=document.createElement("button");e.innerHTML="Charges",this.parcel.interaction_requirement&&this.parcel.interaction_requirement.length>0&&(e.innerHTML+=` (${this.parcel.interaction_requirement.length})`),e.addEventListener("click",()=>{this.renderChargeList()}),_.appendChild(e)}let l=document.createElement("button");l.innerHTML="Save",l.addEventListener("click",()=>{this.save()}),_.appendChild(l);let c=document.createElement("button");c.innerHTML="Delete",c.addEventListener("click",()=>{confirm("Are you sure you want to delete this parcel?\nThis action cannot be undone.")&&(console.log("Deleting "+this.parcel.id),this.delete(`${this.parcel.type}:${this.parcel.id}`))}),_.appendChild(c)}renderInteractionList(t){this.renderEditor(),console.log("Rendering list of interactions for "+t);let i=p.capitalise_first_word(t.replace("interaction_",""));if(m.innerHTML=`<h2>${i} Interactions</h2>`,this.parcel[t])for(let e in this.parcel[t]){let i=document.createElement("button");i.innerHTML=e,i.classList.add(p.validity_check(this.parcel[t][e].validate())),i.addEventListener("click",()=>{this.renderInteraction(t,parseInt(e))}),m.appendChild(i)}let n=document.createElement("button");n.innerHTML="Add new "+i,n.addEventListener("click",()=>{let i=new e;i.result=[[`${this.parcel.type}:${this.parcel.id}`,1]],this.parcel[t].push(i),this.renderInteractionList(t)}),m.appendChild(n)}renderChargeList(){if(this.renderEditor(),console.log("Rendering list of charges"),m.innerHTML="<h2>Charges</h2>",void 0!=this.parcel.interaction_requirement){for(let e in this.parcel.interaction_requirement){let t=document.createElement("button");t.innerHTML=String(this.parcel.interaction_requirement[e]),t.addEventListener("click",()=>{this.renderCharge(parseInt(e))}),m.appendChild(t)}let e=document.createElement("button");e.innerHTML="Add new charge",e.addEventListener("click",()=>{this.parcel.interaction_requirement.push(new t),this.renderChargeList()}),m.appendChild(e)}console.log("Rendering list of charges")}renderInteraction(e,t){this.renderInteractionList(e),console.log("Rendering interaction"),g.innerHTML="<h2>"+p.capitalise_first_word(e)+": "+t+"</h2>";let i=document.createElement("div"),n=document.createElement("label");n.innerHTML="Unlocked",i.appendChild(n);let r=document.createElement("input");r.type="checkbox",r.checked=this.parcel[e][t].unlocked,r.addEventListener("change",()=>{this.parcel[e][t].unlocked=r.checked}),i.appendChild(r),g.appendChild(i);let a=document.createElement("button");a.innerHTML="Result ("+this.parcel[e][t].result.length+")",a.addEventListener("click",()=>{this.renderSet(e,t,"result")}),a.classList.add(p.validity_check(this.parcel[e][t].validateProperty("result",this.stored_parcel))),g.appendChild(a);let s=document.createElement("button");s.innerHTML="Require ("+this.parcel[e][t].require.length+")",s.addEventListener("click",()=>{this.renderSet(e,t,"require")}),s.classList.add(p.validity_check(this.parcel[e][t].validateProperty("require",this.stored_parcel))),g.appendChild(s);let l=document.createElement("button");l.innerHTML="Consume ("+this.parcel[e][t].consume.length+")",l.addEventListener("click",()=>{this.renderSet(e,t,"consume")}),l.classList.add(p.validity_check(this.parcel[e][t].validateProperty("consume",this.stored_parcel))),g.appendChild(l)}renderCharge(e){this.renderChargeList(),console.log("Rendering charge")}renderSet(e,t,i){this.renderInteraction(e,t);let n=document.createElement("select");for(let e in this.stored_parcel){let t=document.createElement("option");t.value=this.stored_parcel[e],t.text=this.stored_parcel[e],n.appendChild(t)}let r=this.stored_parcel[0];for(let a in console.log(r),v.innerHTML="<h2>"+p.capitalise_first_word(i)+"</h2>",this.parcel[e][t][i]){let s=document.createElement("div"),l=n.cloneNode(!0);l.value=this.parcel[e][t][i][a][0]||r,l.addEventListener("change",()=>{this.parcel[e][t][i][a][0]=l.value||r,this.renderSet(e,t,i)}),s.appendChild(l);let c=document.createElement("input");c.type="number",c.min="1",c.value=String(this.parcel[e][t][i][a][1])||"1",c.addEventListener("change",()=>{this.parcel[e][t][i][a][1]=parseInt(c.value)||1,this.renderSet(e,t,i)}),s.appendChild(c);let o=document.createElement("button");o.innerHTML="X",o.addEventListener("click",()=>{this.parcel[e][t][i].splice(a,1),this.renderSet(e,t,i)}),s.appendChild(o),v.appendChild(s)}let a=document.createElement("button");a.innerHTML="Add Set",a.addEventListener("click",()=>{this.parcel[e][t][i].push([r,1]),this.renderSet(e,t,i)}),v.appendChild(a)}};if(globalThis.editor=w,w.checkStorage(),w.renderList(),0===w.stored_parcel.length){let t,i,n;console.info("Loading in example parcels!"),(t=new o("quintessence","Quintessence")).owned=1e3,t.unlocked=!0,i=new s("ore_iron","Iron Ore"),(n=new e).result[0]=["unique:quintessence",30],n.consume[0]=["resource:ore_iron",1],i.interaction_sell[0]=n,w.parcel=t,w.save(),w.parcel=i,w.save(),w.checkStorage(),w.renderList()}console.table(w.parcel);
//# sourceMappingURL=index.3477d732.js.map
